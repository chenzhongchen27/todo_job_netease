<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>regularjs - todo 练习页面</title>
	<link rel="stylesheet" type="text/css" href="index.css">
	<script type="text/javascript" src="../resource/regular.js"></script>
	<script src="https://unpkg.com/redux@latest/dist/redux.min.js"></script>
	<script type="text/javascript" src="store.js"></script>
</head>
<body>
<!-- 	<h1>regularjs - todo 练习</h1>  -->	
	<script type="template/regular" id="todomvc">
		<input type="text" id="addTodo" name="addTodo" placeholder="新建todo项目" r-model={newTodo} on-enter={this.actions.addTodo(newTodo)}/>
		<ul class="items">
			{#list todos as todo}
			<li class="item">
				<input type="checkbox" class="toggleItem" r-model={todo.completed}/>
				<span>{todo.descript}</span>
				<button class="delete" on-click={true}>删除</button>
			</li>
			{/list}
		</ul>
		<footer class="control">
			<span><strong>{todos.length}</strong> items </span>
			<ul>
				<li><a r-class={{active:filter=='all'}} href="">all</a></li>
				<li><a r-class={{active:filter=='active'}} href="">active</a></li>
				<li><a r-class={{active:filter=='completed'}} href="">completed</a></li>
				<li><label><input type="checkbox" r-model={isAllCompleted} />toggle all</label> </li>
			</ul>
			<button>clearm {completedLength} completed</button>
		</footer>
	</script>
	<div id="todoapp" class="">
		
	</div>
	<script type="text/javascript">


		var TodoMVC = Regular.extend({
			template:'#todomvc'
			,data:store.getState()
			,computed:{
				isAllCompleted:{
					get:function(){
						return this.data.todos.every(todo=>todo.completed);
					}
					,set:function(bol){this.data.todos.forEach(
						(todo)=>todo.completed = bol
					)}
				}
				,completedLength:function(){
					return this.data.todos.filter(todo=>todo.completed).length
				}
			}
			,actions:Redux.bindActionCreators(actionGenerators,store.dispatch)

		})
		TodoMVC.event('enter',function(elem,fire){
				function update(ev){
					if(ev.which == 13){
						ev.preventDefault();
						fire(ev)
					}
				}
				Regular.dom.on(elem,'keypress',update);
				return function destory(){
					dom.off(elem,'keypress',update)
				}
			}
		)
		var todoMVC = new TodoMVC()
		todoMVC.$inject('#todoapp')
		//保证每次newTodo改变后todoMVC
		store.subscribe(function(){
			todoMVC.data = store.getState();
			todoMVC.$update()
		})
	</script>
</body>
</html>